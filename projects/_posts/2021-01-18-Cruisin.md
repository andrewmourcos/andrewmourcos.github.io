---
layout: projects
title: Cruisin, Custom ADAS
tag: Robotics
description: Creating my own ADAS 
tools: CAN, C++, OpenCV, TF
video: Media/projects/cruisin/flow.mp4
---
Cruisin is my own Advanced Driver Assistance System (ADAS) that plugs into the CAN-bus of my car.

(your browser may require you to watch <a href="https://youtu.be/joPkrqNYnAI">this in youtube</a> instead.)
<iframe src="https://www.youtube.com/embed/joPkrqNYnAI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

# Neat Optical Flow Visual
<video controls src="/Media/projects/cruisin/flow.mp4" width="50%">
    Sorry, your browser doesn't support embedded videos.
</video>
The above video is a behind-the-scenes look at the visual odometry (mapping) feature. The red dots are _features_ that the algorithm extracts and tracks across frames. The pixel trajectories are shown in green.

# Facts about Cruisin
1. **It is a Multi-threaded system** : Cruisin is meant to run in real-time on an embedded device. It needs to be fast and effective at using the available resources.
2. **Reverse Engineering CAN packets can be tough** : All modern cars have a diagnostic port (OBD2) which exposes a CAN bus where computer units communicate. To read data such as the car's speed, you have to manually track down the ID of the computer unit responsible and target specific unknown bytes in the data packet.
3. **It _is_ a bit worse in the rain** : The same route was attempted on a rainy day. It performed reasonably given the conditions, but will need a software component to filter out overly-reflective surfaces and ignore the windshield wipers.

# How I'm getting data from the CAN bus
All cars have a diagnostics port. They expose some CAN-High and CAN-Low lines that the ECUs use to communicate information such as speed, RPM, etc. I had to do a good amount of googling and reverse engineering to decipher the frame ID that corresponded to the useful telemetry sensors. For V1, I spliced an OBD2 cable, found the CAN-H/CAN-L wires and passed them through a CAN-to-USB device to the computer running Cruisin. 
<img src="/Media/projects/cruisin/OBD2.JPG">

**As always, feel free to reach out if you have questions.**
